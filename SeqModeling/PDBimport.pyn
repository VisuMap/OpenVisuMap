import pandas as pd

ALPHABET = 'ARNDCEQGHILKMFPSTWYV'
P = {ALPHABET[k]:k for k in range(len(ALPHABET))}

def IsOK(pSeq):
	for c in pSeq:
		if c not in P:
			return False
	return True

def InitDatabase(dsName, description):
	dsName = vv.Folder.NewDataset(dsName, description).Name
	vv.Folder.OpenDataset(dsName)
	vv.Map.GlyphSet = 'Ordered 64'
	ds = vv.Dataset
	ds.AddColumn('PID', 0, '', 0)
	ds.AddColumn('Accession', 0, '', 1)
	ds.AddColumn('ProteinSeq', 0, '', 2)
	ds.AddColumn('SeqLen', 1, '0', 3)
	ds.AddColumn('Molecular Weight', 1, '0', 4)
	ds.CommitChanges()

def ImportPDBs(fileList):
	errs  = 0
	cnt = 0
	imported = set()
	for fn in fileList:
		df = pd.read_csv(fn)
		n, dim = df.shape[0], df.shape[1]
		if dim != 11:
			print('Invalid dimension in ', fn)
			break
		print('Importing ', fn)
		for k in range(1, n):
			R = df.loc[k]
			if str(R[0]) == 'nan':
				continue
			pSeq = R[6]
			pLen = R[7]
			pId = R[0]
			accession = R[5]
			if accession in imported:
				continue
			if IsOK(pSeq):
				vList = New.StringArray([pId, str(accession), str(pSeq), str(pLen), str(R[9])])
				vv.Dataset.AddRow(pId, str(accession), 0, vList )
				cnt += 1
			else:
				errs += 1
			imported.add(accession)
	vv.Dataset.CommitChanges()
	print('Completed! ', cnt, errs)


'''

fileList = [
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_65001-67500.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_60001-62500.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_55001-57500.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_62501-65000.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_57501-60000.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_50001-52500.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_52501-55000.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_45001-47500.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_37501-40000.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_42501-45000.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_47501-50000.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_32501-35000.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_40001-42500.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_20001-22500.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_30001-32500.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_35001-37500.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_25001-27500.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_15001-17500.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_22501-25000.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_27501-30000.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_17501-20000.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_12501-15000.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_10001-12500.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_02501-05000.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_05001-07500.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_00001-02500.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_07501-10000.csv",
	"C:\\Users\\james\\Downloads\\rcsb_pdb_sequence_e75d659a7a47f988bd1cb7d5df4f2d8d_67501-68454.csv"
	]

InitDatabase('rcsb developmental', 'developmental process (GO:0032502)')

ImportPDBs(fileList)

'''
